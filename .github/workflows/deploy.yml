name: Deploy to GitHub Pages
# Triggering cleanup commit

on:
  push:
    branches:
      - master # Ou a sua branch principal

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Inject Firebase Secrets
        run: |
          sed -e "s/\${FIREBASE_API_KEY}/${{ secrets.FIREBASE_API_KEY }}/g" \
              -e "s/\${FIREBASE_AUTH_DOMAIN}/${{ secrets.FIREBASE_AUTH_DOMAIN }}/g" \
              -e "s/\${FIREBASE_PROJECT_ID}/${{ secrets.FIREBASE_PROJECT_ID }}/g" \
              -e "s/\${FIREBASE_STORAGE_BUCKET}/${{ secrets.FIREBASE_STORAGE_BUCKET }}/g" \
              -e "s/\${FIREBASE_MESSAGING_SENDER_ID}/${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}/g" \
              -e "s/\${FIREBASE_APP_ID}/${{ secrets.FIREBASE_APP_ID }}/g" \
              -e "s/\${FIREBASE_MEASUREMENT_ID}/${{ secrets.FIREBASE_MEASUREMENT_ID }}/g" \
              scripts/firebase-config.template.js > scripts/firebase-config.js

      - name: Inject EmailJS Secrets
        run: |
          sed -e "s/\${EMAILJS_SERVICE_ID}/${{ secrets.EMAILJS_SERVICE_ID }}/g" \
              -e "s/\${EMAILJS_TEMPLATE_ID}/${{ secrets.EMAILJS_TEMPLATE_ID }}/g" \
              -e "s/\${EMAILJS_PUBLIC_KEY}/${{ secrets.EMAILJS_PUBLIC_KEY }}/g" \
              scripts/emailjs-config.template.js > scripts/emailjs-config.js

      - name: Prepare Workspace (Ensure ignored files are published)
        run: rm -f .gitignore

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          publish_branch: gh-pages # Branch onde o site processado ser√° hospedado
